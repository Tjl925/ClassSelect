"use strict";const e=require("../../../../common/vendor.js"),a=require("./validator.js"),o=require("../../common/login-page.mixin.js");require("../../common/store.js");const s=e.Zs.importObject("uni-id-co"),r={mixins:[o.mixin],data:()=>({formData:{username:"",nickname:"",password:"",password2:"",captcha:""},rules:a.rules,focusUsername:!1,focusNickname:!1,focusPassword:!1,focusPassword2:!1,logo:"/static/logo.png"}),onReady(){this.$refs.form.setRules(this.rules)},onShow(){},methods:{submit(){this.$refs.form.validate().then((a=>4!=this.formData.captcha.length?(this.$refs.captcha.focusCaptchaInput=!0,e.index.showToast({title:"请输入验证码",icon:"none",duration:3e3})):this.needAgreements&&!this.agree?this.$refs.agreements.popup((()=>{this.submitForm(a)})):void this.submitForm(a))).catch((e=>{let a=e[0].key;a=a.replace(a[0],a[0].toUpperCase()),this["focus"+a]=!0}))},async submitForm(a){try{const a=await s.registerUser(this.formData);this.loginSuccess(a);const o=e.Zs.database();console.log(this.formData.username);const r=await o.collection("uni-id-users").where({username:this.formData.username}).update({avatar_file:{extname:"png",name:"defaultAvatar",url:"https://mp-55788fb7-2392-4142-8486-dfaba6fb925c.cdn.bspapp.com/cloudstorage/default.png"},user_role:"user"});console.log(r),1===r.result.updated?console.log("用户 avatar_file 更新成功"):console.error("用户 avatar_file 更新失败: 未找到匹配的用户记录")}catch(o){this.$refs.captcha.getImageCaptcha(),console.error("注册或更新失败:",o),e.index.showToast({title:"操作失败，请重试",icon:"none"})}},navigateBack(){e.index.navigateBack()},toLogin(){e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withpwd"})},registerByEmail(){e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/register/register-by-email"})}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-captcha")+e.resolveComponent("uni-id-pages-agreements")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni-captcha/components/uni-captcha/uni-captcha.js")+(()=>"../../components/uni-id-pages-agreements/uni-id-pages-agreements.js")+(()=>"../../../uni-forms/components/uni-forms/uni-forms.js"))();const t=e._export_sfc(r,[["render",function(a,o,s,r,t,n){return{a:t.logo,b:e.o((e=>t.focusUsername=!1)),c:e.o((e=>t.formData.username=e)),d:e.p({inputBorder:!1,focus:t.focusUsername,placeholder:"请输入用户名",trim:"both",modelValue:t.formData.username}),e:e.p({name:"username",required:!0}),f:e.o((e=>t.focusNickname=!1)),g:e.o((e=>t.formData.nickname=e)),h:e.p({inputBorder:!1,focus:t.focusNickname,placeholder:"请输入用户昵称",trim:"both",modelValue:t.formData.nickname}),i:e.p({name:"nickname"}),j:e.o((e=>t.focusPassword=!1)),k:e.o((e=>t.formData.password=e)),l:e.p({inputBorder:!1,focus:t.focusPassword,maxlength:"20",placeholder:"请输入"+("weak"==a.config.passwordStrength?"6":"8")+"-16位密码",type:"password",trim:"both",modelValue:t.formData.password}),m:e.o((e=>t.formData.password=e)),n:e.p({name:"password",required:!0,modelValue:t.formData.password}),o:e.o((e=>t.focusPassword2=!1)),p:e.o((e=>t.formData.password2=e)),q:e.p({inputBorder:!1,focus:t.focusPassword2,placeholder:"再次输入密码",maxlength:"20",type:"password",trim:"both",modelValue:t.formData.password2}),r:e.o((e=>t.formData.password2=e)),s:e.p({name:"password2",required:!0,modelValue:t.formData.password2}),t:e.sr("captcha","2cb42a41-10,2cb42a41-9"),v:e.o((e=>t.formData.captcha=e)),w:e.p({scene:"register",modelValue:t.formData.captcha}),x:e.sr("agreements","2cb42a41-11,2cb42a41-0"),y:e.p({scope:"register"}),z:e.o(((...e)=>n.submit&&n.submit(...e))),A:e.o(((...e)=>n.navigateBack&&n.navigateBack(...e))),B:e.o(((...e)=>n.registerByEmail&&n.registerByEmail(...e))),C:e.o(((...e)=>n.toLogin&&n.toLogin(...e))),D:e.sr("form","2cb42a41-0"),E:e.p({value:t.formData,rules:t.rules,"validate-trigger":"submit","err-show-type":"toast"})}}]]);wx.createPage(t);
