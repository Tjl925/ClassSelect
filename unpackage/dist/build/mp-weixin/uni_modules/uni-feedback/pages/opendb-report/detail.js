"use strict";const e=require("../../../../common/vendor.js"),t=e.Zs.database(),o={data:()=>({queryWhere:"",loadMore:{contentdown:"",contentrefresh:"",contentnomore:""},options:{},reported_id:"",type:"",reported_post:"",reply_content:"",_id:""}),async onLoad(t){if(this._id=t.id,this._id){this.queryWhere=`_id=="${this._id}"`;try{await this.getReportedInfo(),console.log("已获取被举报信息，准备获取评论内容"),await this.getReplyContent()}catch(o){console.error("加载数据出错",o),e.index.showToast({title:"加载数据失败，请稍后再试",icon:"none"})}}},computed:{isReply(){return"评论"===this.type}},methods:{async getReplyContent(){if(this.isReply&&this.reported_id){console.log("正在获取评论讯息:",this.reported_id);try{const e=await t.collection("community_ans").doc(this.reported_id).get();if(console.log(e),!(e.result.data&&Array.isArray(e.result.data)&&e.result.data.length>0))throw new Error("数据为空或格式不正确");this.reported_post=e.result.data[0].post_id,this.reply_content=e.result.data[0].content,this.options={...this.options}}catch(o){console.error("获取评论讯息失败",o),e.index.showToast({title:"获取被举报评论失败！",icon:"none"})}}},async getReportedInfo(){try{const e=await t.collection("reports").doc(this._id).get();if(console.log(e),!(e.result.data&&Array.isArray(e.result.data)&&e.result.data.length>0))throw new Error("数据为空或格式不正确");this.reported_id=e.result.data[0].reported_id,console.log(this.reported_id),this.type=e.result.data[0].type}catch(o){throw console.error("获取被举报信息失败",o),e.index.showToast({title:"获取被举报信息失败！",icon:"none"}),o}},handleConfirm(){e.index.showModal({title:"确认处理",content:"您确认已处理该举报了吗？",success:async o=>{if(o.confirm)try{await t.collection("reports").where({_id:this._id}).update({status:1}),e.index.showToast({title:"确认成功！",icon:"success"}),setTimeout((()=>{e.index.redirectTo({url:"./list"})}),2e3)}catch(n){console.error("确认失败:",n),e.index.showToast({title:"确认失败！，请稍后再试",icon:"none"})}else console.log("用户取消确认")}})},handleDelete(){this.$refs.udb.remove(this._id,{success:t=>{e.index.navigateTo({url:"./list"})},fail:t=>{console.error("删除失败",t),e.index.showToast({title:"删除失败，请稍后再试",icon:"none"})}})},handleDeal(t){"帖子"===this.type?e.index.navigateTo({url:`/pages/community/detail?id=${t}`}):"评论"===this.type?e.index.navigateTo({url:`/pages/community/detail?id=${this.reported_post}`}):"课程信息"===this.type?e.index.navigateTo({url:`/pages/course/detail?_id=${t}`}):"资料"===this.type&&e.index.navigateTo({url:`/pages/material/detail?id=${t}`})},formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}}};if(!Array){(e.resolveComponent("uni-load-more")+e.resolveComponent("unicloud-db"))()}Math||((()=>"../../../uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js"))();const n=e._export_sfc(o,[["render",function(t,o,n,r,i,s){return{a:e.w((({data:t,loading:o,error:n,options:r},a,d)=>e.e({a:n},n?{b:e.t(n.message)}:o?{d:"17b1649c-1-"+d+",17b1649c-0",e:e.p({contentText:i.loadMore,status:"loading"})}:t?e.e({g:e.t(t.type),h:s.isReply},s.isReply?{i:e.t(i.reply_content)}:{},{j:e.t(s.formatDate(t.created_at)),k:e.t(t.reason),l:e.t(t.content),m:e.f(t.imgs,((e,t,o)=>({a:e.path,b:t})))}):{},{c:o,f:t,n:d,o:a})),{name:"d",path:"a",vueId:"17b1649c-0"}),b:e.sr("udb","17b1649c-0"),c:e.p({options:i.options,collection:"reports",field:"content,imgs,created_at,status,reason,type",where:i.queryWhere,getone:!0,manual:!0}),d:e.o((e=>s.handleDeal(i.reported_id))),e:e.o(((...e)=>s.handleConfirm&&s.handleConfirm(...e))),f:e.o(((...e)=>s.handleDelete&&s.handleDelete(...e)))}}]]);wx.createPage(n);
