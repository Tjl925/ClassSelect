"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../uni-id-pages/common/store.js"),i=e.Zs.database();e.Zs.importObject("uni-id-co");const n={data:()=>({formData:{content:"",reason:"",imgs:[],nickname:"",created_at:"",status:0,type:"",reported_id:""},formOptions:{}}),computed:{userInfo:()=>t.store.userInfo},onLoad(t){this.formData.reported_id=t.reported_id,this.formData.type=t.type,this.getUserNickname(this.userInfo._id),e.index.setNavigationBarTitle({title:"填写举报单"})},methods:{getUserNickname(e){return i.collection("uni-id-users").where({_id:e}).field("nickname").get().then((e=>{if(e.result.data&&e.result.data.length>0){const t=e.result.data[0];this.formData.nickname=t.nickname}})).catch((e=>(console.error("获取用户信息失败:",e),"匿名用户")))},submit(){this.formData.created_at=(new Date).toISOString(),this.submitForm(this.formData).catch((()=>{e.index.hideLoading()}))},submitForm(t){i.collection("reports").add(t).then((t=>{e.index.showToast({icon:"none",title:"提交成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>e.index.navigateBack()),500)})).catch((t=>{e.index.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((()=>{e.index.hideLoading()}))}}};if(!Array){(e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni-forms/components/uni-forms/uni-forms.js"))();const o=e._export_sfc(n,[["render",function(t,i,n,o,a,r){return{a:e.t(a.formData.reason||"请选择举报原因"),b:["人身攻击","违法违规","广告","错误信息"],c:e.o((e=>a.formData.reason=["人身攻击","违法违规","广告","错误信息"][e.detail.value])),d:e.p({name:"content",label:"举报原因",required:!0}),e:e.o([e=>a.formData.content=e.detail.value,e=>t.binddata("content",e.detail.value)]),f:a.formData.content,g:e.p({name:"content",label:"举报阐述",required:!0}),h:e.o((e=>a.formData.imgs=e)),i:e.p({"file-mediatype":"image",limit:6,"return-type":"array",modelValue:a.formData.imgs}),j:e.p({name:"imgs",label:"说明图片"}),k:e.o(((...e)=>r.submit&&r.submit(...e))),l:e.sr("form","43b3cd08-0"),m:e.p({value:a.formData,"validate-trigger":"submit","err-show-type":"toast"})}}]]);wx.createPage(o);
