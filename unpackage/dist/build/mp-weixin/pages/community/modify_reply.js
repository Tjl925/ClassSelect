"use strict";const t=require("../../common/vendor.js");require("../../uni_modules/uni-id-pages/common/store.js");const n=t.Zs.database(),o={data:()=>({ans:{_id:"",content:"",post_id:""},ans_count:0,width:"200px",height:"200px",border:!1}),methods:{deleteAns(){t.index.showModal({title:"确认删除",content:"确定要删除这个回复吗？",success:async o=>{if(o.confirm)try{t.index.showLoading({title:"删除中...",mask:!0});const o=await n.collection("community_ans").doc(this.ans._id).remove();if(console.log(o),1!==o.result.deleted)throw new Error("删除失败");this.ans_count-=1,await n.collection("community_post").doc(this.ans.post_id).update({ans_count:this.ans_count}),console.log(this.ans_count),t.index.navigateBack()}catch(s){console.error("删除回复失败:",s),t.index.showToast({title:s.message||"删除失败",icon:"none"})}finally{t.index.hideLoading()}else o.cancel&&console.log("用户取消删除")}})},async fetchPostDetails(){try{const t=await n.collection("community_ans").doc(this.ans._id).get();if(!(t.result.data&&Array.isArray(t.result.data)&&t.result.data.length>0))throw new Error("未找到回复信息");{const n=t.result.data[0];this.ans.content=n.content,this.ans.post_id=n.post_id}}catch(o){console.error("获取信息失败:",o),t.index.showToast({title:"获取信息失败",icon:"none"})}},async fetchCountDetails(){try{const t=await n.collection("community_post").doc(this.ans.post_id).get();if(!(t.result.data&&Array.isArray(t.result.data)&&t.result.data.length>0))throw new Error("未找到点赞信息");{const n=t.result.data[0];this.ans_count=n.ans_count}}catch(o){console.error("获取点赞信息失败:",o),t.index.showToast({title:"获取点赞信息失败",icon:"none"})}},async submitAnsInfo(){if(""!==this.ans.content.trim()){console.log(this.ans.content);try{t.index.showLoading({title:"提交中...",mask:!0}),this.ans_count-=1,console.log(this.ans._id);const o=await n.collection("community_ans").doc(this.ans._id).update({content:this.ans.content});if(console.log(o),!o.result.updated)throw new Error("修改失败");t.index.showToast({title:"修改成功",icon:"success"}),setTimeout((()=>{t.index.navigateBack()}),2e3)}catch(o){console.error("提交回复信息失败:",o),t.index.showToast({title:o.message||"提交失败",icon:"none"})}finally{t.index.hideLoading()}}else t.index.showToast({title:"内容不能为空",icon:"none"})},navBack(){t.index.navigateBack()}},onLoad(n){this.ans._id=n.replyId,this.ans.post_id=n.post_id,t.index.setNavigationBarTitle({title:"修改回复信息"}),this.fetchPostDetails().then((()=>{this.fetchCountDetails()}))}};const s=t._export_sfc(o,[["render",function(n,o,s,e,i,a){return{a:i.ans.content,b:t.o((t=>i.ans.content=t.detail.value)),c:t.o((t=>a.navBack())),d:t.o((t=>a.submitAnsInfo())),e:t.o((t=>a.deleteAns())),f:t.o(((...t)=>a.submitAnsInfo&&a.submitAnsInfo(...t)))}}],["__scopeId","data-v-7f2b0969"]]);wx.createPage(s);
