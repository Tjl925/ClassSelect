"use strict";const e=require("../../common/vendor.js"),a=e.Zs.database(),t={components:{statusBar:()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-status-bar.js"},computed:{inputPlaceholder:a=>"en"==e.index.getStorageSync("CURRENT_LANG")?"Please enter the search content":"请输入搜索内容"},data:()=>({materials:[],where:'"article_status" == 1',keyword:"",showRefresh:!1,listHight:0,pageSize:8}),watch:{keyword(e,a){let t='"article_status" == 1 ';this.where=e?`"article_status" == 1 && /${e}/.test(material_name)`:t}},async onReady(){this.listHight="auto"},async onShow(){this.keyword=getApp().globalData.searchText,getApp().globalData.searchText="",this.getMaterials()},onReachBottom(){console.log(this.materials),this.materials.length>this.pageSize?(console.log("当前课程数量："+this.materials.length),this.pageSize+=5):e.index.showToast({title:"已加载全部记录",icon:"none"})},methods:{toCreate(){e.index.navigateTo({url:"/pages/material/create_material/create_material"})},getMaterials(){e.index.showLoading({title:"加载中...",mask:!0});let t=a.collection("materials");if(this.keyword.trim()){const e=this.keyword.trim();t=t.where(a.command.or([{material_name:new RegExp(e,"i")},{course_name:new RegExp(e,"i")}]))}t.get().then((async e=>{if(e.result.data&&Array.isArray(e.result.data)){const a=await Promise.all(e.result.data.map((async e=>{const a=await this.getUserInfo(e.creator_id);return{...e,userInfo:a}})));this.materials=a}else this.materials=[]})).catch((a=>{console.error("获取资料数据失败:",a),e.index.showToast({title:"加载资料数据失败",icon:"none"})})).finally((()=>{e.index.hideLoading()}))},getUserInfo:e=>a.collection("uni-id-users").where({_id:e}).field("nickname").get().then((e=>{if(e.result.data&&e.result.data.length>0){return{nickname:e.result.data[0].nickname||"匿名用户"}}return{nickname:"匿名用户"}})).catch((e=>(console.error("获取用户信息失败:",e),{nickname:"匿名用户"}))),searchClick(a){e.index.hideKeyboard(),e.index.navigateTo({url:"/pages/material/search/search",animationType:"fade-in"})}}};if(!Array){(e.resolveComponent("uni-search-bar")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list"))()}Math||((()=>"../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js"))();const i=e._export_sfc(t,[["render",function(a,t,i,n,s,r){return{a:e.sr("searchBar","0b8a7346-0"),b:e.o((e=>s.keyword=e)),c:e.p({radius:"100",cancelButton:"none",disabled:!0,placeholder:r.inputPlaceholder,modelValue:s.keyword}),d:e.o(((...e)=>r.searchClick&&r.searchClick(...e))),e:e.f(s.materials.slice(0,s.pageSize),((a,t,i)=>({a:e.t(a.material_name),b:e.t(a.userInfo.nickname),c:e.t(a.average_rating||"待评分"),d:t,e:"0b8a7346-2-"+i+",0b8a7346-1",f:e.p({to:"/pages/material/detail?id="+a._id+"&title="+a.material_name,direction:"row"})}))),f:s.listHight,g:e.p({border:!0}),h:e.o(((...e)=>r.toCreate&&r.toCreate(...e)))}}],["__scopeId","data-v-0b8a7346"]]);wx.createPage(i);
