"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),i=e.Zs.database(),t={data:()=>({material:{created_at:"",material_name:"",_id:"",category:"",course_name:"",material_image:[],download_link:""}}),methods:{deleteMaterial(){e.index.showModal({title:"确认删除",content:"确定要删除这个资料吗？",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"删除中...",mask:!0});const a=await i.collection("materials").doc(this._id).remove();if(console.log(a),1!==a.result.deleted)throw new Error("删除失败");e.index.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{e.index.switchTab({url:"/pages/material/material"})}),2e3)}catch(t){console.error("删除资料失败:",t),e.index.showToast({title:t.message||"删除失败",icon:"none"})}finally{e.index.hideLoading()}else a.cancel&&console.log("用户取消删除")}})},async fetchMaterialDetails(){try{const e=await i.collection("materials").doc(this._id).get();if(console.log(e),!(e.result.data&&Array.isArray(e.result.data)&&e.result.data.length>0))throw new Error("未找到资料信息");{const a=e.result.data[0];this.material={material_name:a.material_name||"",category:a.category||"",course_name:a.course_name||"",material_image:a.material_image||[],download_link:a.download_link||""}}}catch(a){console.error("获取资料信息失败:",a),e.index.showToast({title:"获取资料信息失败",icon:"none"})}},async submitMaterialInfo(){try{e.index.showLoading({title:"提交中...",mask:!0});const a=await i.collection("materials").doc(this._id).update({material_image:this.material.material_image,material_name:this.material.material_name,category:this.material.category,course_name:this.material.course_name,download_link:this.material.download_link});if(console.log(a),!a.result.updated)throw new Error("修改失败");e.index.showToast({title:"修改成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),2e3)}catch(a){console.error("提交资料信息失败:",a),e.index.showToast({title:a.message||"提交失败",icon:"none"})}finally{e.index.hideLoading()}},navBack(){e.index.navigateBack()}},onLoad(a){this._id=a._id,e.index.setNavigationBarTitle({title:"修改资料信息"}),this.fetchMaterialDetails()}};if(!Array){(e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms-item"))()}Math||((()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js"))();const o=e._export_sfc(t,[["render",function(i,t,o,r,l,n){return{a:e.o((e=>l.material.material_image=e)),b:e.p({"file-mediatype":"image",limit:1,"return-type":"array",modelValue:l.material.material_image}),c:e.p({name:"imgs",label:"资料图片(可选)"}),d:a._imports_0$1,e:l.material.material_name,f:e.o((e=>l.material.material_name=e.detail.value)),g:a._imports_1$3,h:e.t(l.material.category||"请选择资料类别"),i:["其他","各类表单","实验报告","往年试卷","竞赛","考研","课件","课后答案","软件","重点总结"],j:e.o((e=>l.material.category=["其他","各类表单","实验报告","往年试卷","竞赛","考研","课件","课后答案","软件","重点总结"][e.detail.value])),k:a._imports_2$1,l:l.material.course_name,m:e.o((e=>l.material.course_name=e.detail.value)),n:a._imports_3,o:l.material.download_link,p:e.o((e=>l.material.download_link=e.detail.value)),q:e.o((e=>n.navBack())),r:e.o((e=>n.submitMaterialInfo())),s:e.o((e=>n.deleteMaterial())),t:e.o(((...e)=>n.submitMaterialInfo&&n.submitMaterialInfo(...e)))}}],["__scopeId","data-v-0397780c"]]);wx.createPage(o);
