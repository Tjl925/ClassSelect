"use strict";const e=require("../../../common/vendor.js"),t=e.Zs.database(),a={components:{statusBar:()=>"../../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-status-bar.js"},data:()=>({materials:[],keyword:"",showRefresh:!1,listHight:0,pageSize:8}),async onReady(){this.listHight="auto"},async onShow(){this.getMaterials()},onReachBottom(){console.log(this.materials),this.materials.length>this.pageSize?(console.log("当前资料数量："+this.materials.length),this.pageSize+=5):e.index.showToast({title:"已加载全部记录",icon:"none"})},methods:{getMaterials(){e.index.showLoading({title:"加载中...",mask:!0}),t.collection("materials").where({average_rating:t.command.gt(3.9)}).orderBy("average_rating","desc").get().then((async e=>{if(e.result.data&&Array.isArray(e.result.data)){console.log("资料信息",e);const t=await Promise.all(e.result.data.map((async e=>{const t=await this.getUserInfo(e.creator_id);return{...e,userInfo:t}})));this.materials=t}else this.materials=[]})).catch((t=>{console.error("获取资料数据失败:",t),e.index.showToast({title:"加载资料数据失败",icon:"none"})})).finally((()=>{e.index.hideLoading()}))},getUserInfo:e=>t.collection("uni-id-users").where({_id:e}).field("nickname").get().then((e=>{if(e.result.data&&e.result.data.length>0){return{nickname:e.result.data[0].nickname||"匿名用户"}}return{nickname:"匿名用户"}})).catch((e=>(console.error("获取用户信息失败:",e),{nickname:"匿名用户"})))}};if(!Array){(e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list"))()}Math||((()=>"../../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../../uni_modules/uni-list/components/uni-list/uni-list.js"))();const i=e._export_sfc(a,[["render",function(t,a,i,n,s,o){return{a:e.f(s.materials.slice(0,s.pageSize),((t,a,i)=>({a:e.t(t.material_name),b:e.t(t.userInfo.nickname),c:e.t(t.average_rating||"待评分"),d:a,e:"7ca937b1-1-"+i+",7ca937b1-0",f:e.p({to:"/pages/material/detail?id="+t._id+"&title="+t.material_name,direction:"row"})}))),b:e.p({border:"false"})}}]]);wx.createPage(i);
