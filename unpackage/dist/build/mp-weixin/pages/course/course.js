"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),s=e.Zs.database();let o;const r={components:{statusBar:()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-status-bar.js"},computed:{inputPlaceholder:t=>"en"==e.index.getStorageSync("CURRENT_LANG")?"Please enter the search content":"请输入搜索内容"},data:()=>({where:'"status" == 1',courses:[],keyword:"",pageSize:15}),watch:{keyword(e,t){let s='"status" == 1 ';this.where=e?`"status" == 1 && /${e}/.test(course_name)`:s}},async onReady(){this.listHight="auto",o=this.$refs.udb},onShow(){this.keyword=getApp().globalData.searchText||"",getApp().globalData.searchText="",this.getCourses()},onLoad(){e.index.setNavigationBarTitle({title:"课程列表"})},onReachBottom(){console.log(this.courses),this.courses.length>this.pageSize?(console.log("当前课程数量："+this.courses.length),this.pageSize+=5):e.index.showToast({title:"已加载全部记录",icon:"none"})},methods:{toCreate(){e.index.navigateTo({url:"/pages/course/create_course/create_course"})},searchClick(t){e.index.hideKeyboard(),e.index.navigateTo({url:"/pages/course/search/search",animationType:"fade-in"})},retry(){this.refresh()},refresh(){o.loadData({clear:!0},(()=>{e.index.stopPullDownRefresh(),console.log("end")})),console.log("refresh")},loadMore(){o.loadMore()},onqueryerror(e){console.error(e)},onpullingdown(e){console.log(e),this.showRefresh=!0,e.pullingDistance>100&&this.refresh()},getCourses(){e.index.showLoading({title:"加载中...",mask:!0});let t=s.collection("course-info").orderBy("created_at","desc");if(this.keyword.trim()){const e=this.keyword.trim();t=t.where(s.command.or([{teacher_name:new RegExp(e,"i")},{course_name:new RegExp(e,"i")}]))}t.get().then((async e=>{if(e.result.data&&Array.isArray(e.result.data)){const t=await Promise.all(e.result.data.map((e=>({...e}))));this.courses=t}else this.courses=[]})).catch((t=>{console.error("获取课程数据失败:",t),e.index.showToast({title:"加载课程数据失败",icon:"none"})})).finally((()=>{e.index.hideLoading()}))},getCourseRating:e=>s.collection("course_ratings").where({course_id:e}).get().then((e=>{if(e.result.data&&e.result.data.length>0){const t=e.result.data.map((e=>e.rating));return t.reduce(((e,t)=>e+t),0)/t.length}return"待评分"})).catch((e=>(console.error("获取课程评分失败:",e),0)))}};if(!Array){(e.resolveComponent("uni-search-bar")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list"))()}Math||((()=>"../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js"))();const a=e._export_sfc(r,[["render",function(s,o,r,a,n,i){return{a:e.sr("searchBar","409f086e-0"),b:e.o((e=>n.keyword=e)),c:e.p({radius:"100",cancelButton:"none",disabled:!0,placeholder:i.inputPlaceholder,modelValue:n.keyword}),d:e.o(((...e)=>i.searchClick&&i.searchClick(...e))),e:e.f(n.courses.slice(0,n.pageSize),((t,s,o)=>({a:e.t(t.course_name),b:e.t(t.teacher_name),c:e.t(t.average_rating||"待评分"),d:s,e:"409f086e-2-"+o+",409f086e-1",f:e.p({to:"/pages/course/detail?_id="+t._id})}))),f:t._imports_0,g:e.p({border:"false"}),h:e.o(((...e)=>i.toCreate&&i.toCreate(...e)))}}]]);wx.createPage(a);
