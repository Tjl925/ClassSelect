"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),s=e.Zs.database(),t={data:()=>({course:{created_at:"",course_name:"",course_location:"",teacher_name:"",course_number:"",credit:"",_id:"",college:""}}),methods:{deleteCourse(){e.index.showModal({title:"确认删除",content:"确定要删除这门课程吗？",success:async o=>{if(o.confirm)try{e.index.showLoading({title:"删除中...",mask:!0});const o=await s.collection("course-info").doc(this._id).remove();if(console.log(o),1!==o.result.deleted)throw new Error("删除失败");e.index.showToast({title:"删除成功",icon:"success"}),setTimeout((()=>{e.index.switchTab({url:"/pages/course/course"})}),2e3)}catch(t){console.error("删除课程失败:",t),e.index.showToast({title:t.message||"删除失败",icon:"none"})}finally{e.index.hideLoading()}else o.cancel&&console.log("用户取消删除")}})},async fetchCourseDetails(){try{console.log(this._id);const e=await s.collection("course-info").doc(this._id).get();if(console.log(e),!e.data.length)throw new Error("未找到课程信息");{const o=e.data[0];this.course={course_name:o.course_name,course_location:o.course_location,teacher_name:o.teacher_name,course_number:o.course_number,college:o.college,credit:o.credit}}}catch(o){console.error("获取课程信息失败:",o),e.index.showToast({title:"获取课程信息失败",icon:"none"})}},async fetchCourseDetails(){try{const e=await s.collection("course-info").doc(this._id).get();if(console.log(e),!(e.result.data&&Array.isArray(e.result.data)&&e.result.data.length>0))throw new Error("未找到课程信息");{const o=e.result.data[0];this.course={course_name:o.course_name||"",course_location:o.course_location||"",teacher_name:o.teacher_name||"",course_number:o.course_number||"",college:o.college||"",credit:o.credit||""}}}catch(o){console.error("获取课程信息失败:",o),e.index.showToast({title:"获取课程信息失败",icon:"none"})}},async submitCourseInfo(){try{e.index.showLoading({title:"提交中...",mask:!0});const o=await s.collection("course-info").doc(this._id).update({course_name:this.course.course_name,course_location:this.course.course_location,teacher_name:this.course.teacher_name,course_number:this.course.course_number,college:this.course.college,credit:this.course.credit});if(console.log(o),!o.result.updated)throw new Error("修改失败");e.index.showToast({title:"修改成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),2e3)}catch(o){console.error("提交课程信息失败:",o),e.index.showToast({title:o.message||"提交失败",icon:"none"})}finally{e.index.hideLoading()}},navBack(){e.index.navigateBack()}},onLoad(o){this._id=o._id,e.index.setNavigationBarTitle({title:"修改课程信息"}),this.fetchCourseDetails()}};const c=e._export_sfc(t,[["render",function(s,t,c,r,i,a){return{a:o._imports_0$2,b:i.course.course_name,c:e.o((e=>i.course.course_name=e.detail.value)),d:o._imports_0,e:i.course.teacher_name,f:e.o((e=>i.course.teacher_name=e.detail.value)),g:o._imports_2$2,h:i.course.credit,i:e.o((e=>i.course.credit=e.detail.value)),j:o._imports_3$1,k:i.course.college,l:e.o((e=>i.course.college=e.detail.value)),m:o._imports_4,n:e.t(i.course.course_location||"请选择开课校区"),o:["江安","望江","华西"],p:e.o((e=>i.course.course_location=["江安","望江","华西"][e.detail.value])),q:o._imports_5,r:i.course.course_number,s:e.o((e=>i.course.course_number=e.detail.value)),t:e.o((e=>a.navBack())),v:e.o((e=>a.submitCourseInfo())),w:e.o((e=>a.deleteCourse())),x:e.o(((...e)=>a.submitCourseInfo&&a.submitCourseInfo(...e)))}}],["__scopeId","data-v-4504419e"]]);wx.createPage(c);
